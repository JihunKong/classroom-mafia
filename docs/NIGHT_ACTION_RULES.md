# 밤 행동 상호작용 규칙 (Night Action Interaction Rules)

## 처리 순서 (Processing Order)

밤 행동은 다음 순서로 처리됩니다:

1. **역할 차단 (Role Blocking)** - 최우선 처리
   - 술집사장이 차단한 플레이어는 그 밤에 능력을 사용할 수 없음
   - 차단된 플레이어의 행동은 무시됨

2. **보호 효과 적용 (Protection Effects)**
   - 의사의 치료 대상 기록
   - 군인의 패시브 방어막 확인

3. **공격 행동 수집 (Attack Actions)**
   - 마피아 팀의 투표로 결정된 타겟
   - 늑대인간의 추가 공격 (짝수 날만)
   - 기타 특수 공격 능력

4. **조사 행동 처리 (Investigation Actions)**
   - 경찰의 조사
   - 탐정의 조사 (20% 오류 가능성)
   - 기자의 공개 조사
   - 영매의 죽은 자 조사

5. **특수 행동 처리 (Special Actions)**
   - 도둑의 능력 복사
   - 환술사의 역할 교환
   - 마법사의 저주

6. **공격 vs 보호 해결 (Attack vs Protection Resolution)**
   - 보호받은 플레이어는 생존
   - 보호받지 못한 플레이어는 사망

7. **결과 공개 (Result Broadcasting)**
   - 공개 메시지 (사망/생존)
   - 개인 메시지 (조사 결과 등)

## 주요 상호작용 규칙

### 1. 의사의 치료 (Doctor's Heal)
- **효과**: 대상을 모든 공격으로부터 보호
- **우선순위**: 공격보다 우선
- **특이사항**: 
  - 자기 자신도 치료 가능
  - 같은 대상을 연속으로 치료 가능

### 2. 군인의 방어 (Soldier's Defense)
- **효과**: 첫 번째 공격을 자동으로 방어
- **우선순위**: 의사 치료와 동일
- **특이사항**: 
  - 게임당 1회만 발동
  - 패시브 능력이므로 차단 불가

### 3. 술집사장의 차단 (Bartender's Block)
- **효과**: 대상의 밤 능력 사용 차단
- **우선순위**: 최우선
- **특이사항**: 
  - 패시브 능력은 차단 불가
  - 마피아의 기본 공격은 차단 불가 (팀 행동)

### 4. 늑대인간의 추가 공격 (Werewolf's Extra Kill)
- **효과**: 짝수 날 밤에 추가 살해
- **우선순위**: 마피아 공격과 동일
- **특이사항**: 
  - 마피아 타겟과 다른 대상 선택 가능
  - 의사가 두 타겟 중 하나만 치료해도 각각 독립적으로 처리

### 5. 도둑의 능력 복사 (Thief's Steal)
- **효과**: 대상의 능력을 그날 밤 사용
- **우선순위**: 대상의 능력에 따름
- **특이사항**: 
  - 복사한 능력은 즉시 사용해야 함
  - 원래 소유자는 그날 밤 능력 사용 불가

### 6. 조사 능력들 (Investigation Abilities)
- **경찰**: 정확한 팀 정보 (마피아/시민)
- **탐정**: 80% 정확도
- **기자**: 역할 공개 (다음 날 낮에)
- **영매**: 죽은 자의 역할 확인

### 7. 특수 케이스
- **스파이**: 경찰 조사에 시민으로 표시
- **간첩**: 조사 시 무작위 시민 역할로 표시
- **변절자**: 조건 충족 시 팀 변경

## 충돌 해결 규칙

1. **동시 타겟팅**
   - 여러 명이 같은 대상을 타겟한 경우, 모든 행동이 독립적으로 처리
   - 예: 의사가 A를 치료하고, 경찰이 A를 조사하면 둘 다 성공

2. **순환 참조**
   - A가 B를, B가 A를 타겟한 경우도 정상 처리
   - 예: 환술사가 A와 B의 역할을 바꾸면 즉시 적용

3. **죽은 자 타겟팅**
   - 그날 밤 죽은 플레이어를 타겟한 행동은 실패
   - 단, 영매는 죽은 자를 타겟할 수 있음

## 디버깅 및 로그

모든 밤 행동은 다음과 같이 로그됩니다:
- 행동 제출: `[플레이어명] submitted [action_type] targeting [target_name]`
- 차단: `[플레이어명]'s action was blocked by bartender`
- 보호: `[플레이어명] was protected by doctor`
- 결과: `Night action results: X died, Y survived`